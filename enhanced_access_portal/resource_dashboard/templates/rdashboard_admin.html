{% load static %}
<!DOCTYPE html>
<html>

    <!--https://www.w3schools.com/html/html_div.asp -->

    <!--  
        div.login_panel
        ---------------
        - Auto scale in width to 50% of screen size
        - Overflows in x and y direction
        - Stack from the left when stacking horizontally
    -->
    <style>
        
        body {
            background-color: rgb(246, 247, 252);
            height: 100%;
            margin: 0;
            display: flex;
            background-image: url("{% static 'BackdropImage1.png' %}");
        }

        .main_panel {
            width: 100%;
            height: 100vh; /* Full vertical height */
            overflow: auto;
        }

        .login_panel_bg {
            width: 50%;
            height: 100vh; /* Full vertical height */
            overflow: auto;

          
           background-image: url("{% static 'ServerFarm2.png' %}"); 
           background-size: cover; 
           background-position: center;
           background-color: #fb771a;
        
           position: relative;
        }

        .login_column {
            width: 70%;
            margin: auto; /* Centre column */
            height: 100vh;
            background-color: rgba(246, 247, 252, 0); /* Debug colour:  rgb(186, 186, 189)*/
            overflow: auto; /* Solves scrollbar issue */

            justify-content: center; /* Horizontal centre */
            align-items: center; /* Vertical centre */
            display: flex;
        }

        .login_options {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .alternate_login_options {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 3%;
        }

        .login_section{
            align-items: center;
            /* https://blog.hubspot.com/website/css-margin-vs-padding#:~:text=What's%20the%20difference%20between%20margin,border%20and%20the%20element's%20content. */
            margin-bottom: 2%;
            padding-left: 3%;
            padding-right: 3%;
            padding-bottom: 4%;
            width: 80%;
            height: 60%;

            background-color: #FFFFFF;
            border-radius: 0.5rem;
            filter: drop-shadow(5px 5px 6px);
            
            /* Stops child elements from being visibile if it goes out of main element boundaries */
            overflow: hidden;
        }

        .login_button{
            color: #fff;
            background-color: #333579;
            border-color: #333579;
            border: 1px solid transparent;
            border-radius: 0.25rem;

            width: 100%;
            position: relative; 
            z-index: 1; 
            height: 54px;
            display:block;
            margin:auto;
            margin-top: 9%; /*Using padding seems to shift the text position. Useful for later*/

            font-size: 1.2em;
            
            /* https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_button_css */
            cursor: pointer;
            text-align: center;
        }
        
        .alternate_button{
            color: #ffff;
            background-color: #212529;
            border-color: #212529;
            border: 1px solid transparent;
            border-radius: 0.25rem;

            padding: 0.375rem 0.75rem;

            width: 20%;
            height: 100%;
            
            font-size: 0.9em;
            
            /* https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_button_css */
            cursor: pointer;
            text-align: center;
        }

        .alternate_connect_button{
            color: #ffff;
            background-color: #212529;
            border-color: #212529;
            border: 1px solid transparent;
            border-radius: 0.25rem;

            padding: 0.375rem 0.75rem;

            width: 20%;
            height: 60%;
            
            font-size: 0.9em;
            
            /* https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_button_css */
            cursor: pointer;
            text-align: center;
        }

        .alternate_button_2{
            color: #ffff;
            background-color: #212529;
            border-color: #212529;
            border: 1px solid transparent;
            border-radius: 0.25rem;

            padding: 0.375rem 0.75rem;

            width: 20%;
            height: 5%;
            
            font-size: 0.9em;
            
            /* https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_button_css */
            cursor: pointer;
            text-align: center;
        }

        .login_button:hover {
            /* https://developer.mozilla.org/en-US/docs/Learn_web_development/Howto/Solve_CSS_problems/Transition_button */
            background-color: #4F52BD;
        }

        .entry_style1{
            width: -webkit-fill-available;
            padding: 0.375rem 0.75rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.1);
            display: block;
            border-radius: 0.25rem;
            overflow: auto;
        }

        a, span, label, h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
            font-family: "Roboto", sans-serif;
            color: #212529;
        }

        .roboto_font {
            /* Alternative to the above text tag overrides*/
            font-family: "Roboto", sans-serif;
            color: #212529;
        }

        .login_page_slogan {
            font-family: "Roboto", sans-serif;
            font-weight: bold;
            font-stretch: expanded;
            color: #FFFFFF;
            font-size: 2.5em;

            position: relative;  /* ensures text is over background */
            z-index: 1;
            padding: 2rem;
            transform: translate(30%, 40%);
        }

        input [type=submit] {
            font-size: 1.5em;
        }

        .button_wrapper {
            position: relative;
            width: 100%;
        }

        .loader {
            width: 30px;       /* adjust size as needed */
            height: 30px;
            pointer-events: none; /* allows clicks to pass through */
        }

        .nine_square_button_icon {
            width: 90%;       /* or auto */
            height: 80%;
            padding: 0;
            border: none;
            background-color: #f0f0f000;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;

            transform: translate(3.5%, 0%);
        }
        
        .panel_image_button {
            width: 90%;       /* or auto */
            height: 90%;
            padding: 0;
            border: none;
            background-color: #f0f0f000;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .header_title {
            font-family: "Roboto", sans-serif;
            font-weight: bold;
            font-stretch: expanded;
            color: #212529;
            font-size: 1.5em;
        }

        .panel_toggle_button {
            background-color: #212529;
            border-color: #212529;
            border: 1px solid transparent;
            border-radius: 0.25rem;
            
            font-size: 0.9em;
            
            /* https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_button_css */
            cursor: pointer;
            text-align: center;

            filter: drop-shadow(3px 2px 4px);
        }

        .panel_button {
            background-color: #d1d1d1;
            border-color: #212529;
            border: 1px solid transparent;
            border-radius: 0.25rem;
            
            padding: 4px;
            padding-bottom: 8px;

            font-size: 0.9em;
            
            /* https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_button_css */
            cursor: pointer;
            text-align: center;

            filter: drop-shadow(3px 2px 4px);

            width: 100%; 
            height: 17%;
        }

        .width_section_length {
            width: 100%;
        }

        .rounded_container { 
            background-color: #ffffff; 
            border-radius: 0.5rem; 
            border: 2px solid #212529;
        }

        .project_entry { 
            align-items: center; 
            display: block; 
            padding-left: 2%; 
            padding-top: 2%; 
            padding-bottom: 2%; 
            margin-left: 1.5%;
            margin-top: 1.5%
        }

        .project_entry_p1{
            font-size: 1vw; 
            margin: 0px; 
            font-weight: bold; 
            margin-right: 2%;
        }

        .project_entry_p2{
            font-size: 0.8vw; 
            margin: 0px; 
            font-weight: bold; 
            margin-right: 2%;
        }

        .vms_content{ 
            width: 100%; 
            margin-bottom: 2%; 
            padding-left: 5%;
        }

        .member_content {
            width: 100%; 
            height: 15%; 
            margin-bottom: 2%; 
            padding-left: 5%; 
            text-align: center;
        }
    </style>

    <body>
        
        <div class = "main_panel" style="display:flex">
            <div class = "login_column">
                <div class = "login_section " style="z-index: 1; position: relative;">
                    
                    <div class = "upper_panel width_section_length" style = "align-items: center; display: flex; height: 12%">
                        <p class = "header_title" style = "padding-right: 15%; font-size: 140%; width: 60%;">
                            Resource dashboard - Admin | Enhanced access 
                        </p>

                        <div id="name_email_display" style = "padding-right: 8%; width: 20%;">
                            <p id = "name_display" class = "roboto_font" style = "margin: 0px; font-size: 90%">
                                Ambrose, Odongkara 
                            </p>
                               
                            <p id = "email_display" class = "roboto_font" style = "margin: 0px; font-size: 80%">
                                ambrose@gmail.com
                            </p>
                        </div>
                        
                        <div style="text-align: right; margin-right: 0.45%;">
                            <button id = "panel_toggle_button" type="button" onclick="" class = "panel_toggle_button" style = "width: 110%; height: 50px;">
                                <img id="panel_toggle_button" src="{% static 'NineSquareButtonIcon.png' %}" class="nine_square_button_icon" alt="Panel toggle" />
                            </button>
                        </div>
                    </div>
                    
                    
                    

                    <div class = "width_section_length" style="height: 5.5%; display: grid; align-items: center; display: flex; margin-bottom: 3%;" >

                            <!-- "display: block;" helps put the elements on seperate lines */ -->
                            <input type="text" placeholder="Search VMs" id="vm_search" class="entry_style1" style = "width: 80%; margin-right: 1%;"> 
                     
                            <button id = "x1" type="button" onclick="USER_PROMPT_register_section()" class = "alternate_button">
                                Search
                            </button>
                    
                    </div>
                    
                    <div id = "content-panel" style = "align-items: center; display: flex; height: 70%;">

                        <div class = "left_panel" style = "width: 12%; height: 100%; align-items: center;">

                            <button id = "projects_button" type="button" onclick="section_reveal('projects_section')" class = "panel_button" style = "margin-top: 5px;">
                                <img id="panel_toggle_button" src="{% static 'ProjectsIcon2.png' %}" class="nine_square_button_icon" alt="Projects" style = "width: 80%; transform: translate(12%, 0%);"/>
                                <p style = "color: #212529; margin: 0px">Projects</p>
                            </button>
    
                            <button id = "groups_button" type="button" onclick="section_reveal('groups_section')" class = "panel_button" style = "margin-top: 5px;">
                                <img id="panel_toggle_button" src="{% static 'GroupsIcon.png' %}" class="nine_square_button_icon" alt="VM groupings" style = "width: 70%; transform: translate(19%, 0%);" />
                                <p style = "color: #212529; margin: 0px">Groups</p>
                            </button>

                            <button id = "all_vms_button" type="button" onclick="section_reveal('all_vms_section')" class = "panel_button" style = "margin-top: 5px;">
                                <img id="panel_toggle_button" src="{% static 'AllVMsIcon.png' %}" class="nine_square_button_icon" alt="All VMS" style = "width: 90%; transform: translate(5%, 0%);" />
                                <p style = "color: #212529; margin: 0px">All VMs</p>
                            </button>

                            <button id = "statistics_button" type="button" onclick="section_reveal('statistics_section')" class = "panel_button" style = "margin-top: 5px;">
                                <img id="panel_toggle_button" src="{% static 'StatisticsIcon.png' %}" class="nine_square_button_icon" alt="Statistics" style = "width: 80%; transform: translate(9.5%, 0%);" />
                                <p style = "color: #212529; margin: 0px">Statistics</p>
                            </button>


                            <button id = "logout_button" type="button" onclick="USER_ADMIN_PROMPT_logout_attempt()" class = "panel_button" style = "margin-top: 30px; background-color: #4F52BD;">
                                <img id="panel_toggle_button" src="{% static 'LogoutIcon.png' %}" class="nine_square_button_icon" alt="Logout" style = "transform: translate(14%, 0%); pointer-events: none;" />
                                <p style = "color: #FFFFFF; margin: 0px; pointer-events: none;">Logout</p>
                            </button>
                            
                        </div>
                        
                        
                        <div id = "right_content" class = "rounded_container" style = "width: 100vw; height: 100%; margin-left: 2%; align-items: center; display: flex;">
                            <div id = "logging_out_section" style = "display: none; width: 100%; height: 100%;">
                                <div id = "logging_out_content" style = "width: 100%; height: 40%; align-items: center;">
                                    <div style = "justify-content: center; align-items: center; display: flex; height: 100%;">
                                        <p class = "roboto_font" style = "font-size: 2vw; margin: 0px; font-weight: bold; margin-right: 2%;">Logging out</p>
                                        <img id="register_loading_icon" src="{% static 'LoadingCircleGif2-Adjusted.gif' %}" class="loader" alt="loading" />
                                    </div>
                                </div>
                            </div>

                            
                            <div id = "projects_section" style = "display: flex; width: 100%; height: 100%;">
                               <!-- Display is typically "grid" for "project_content" -->
                               <div id = "project_content" style = "
                                    display: grid; 
                                    grid-template-columns: repeat(2, 1fr);
                                    

                                    width: 100%; 
                                    height: 100%; 
                                    align-items: center;
                                    overflow-y: auto;
                                    ">

                                    <!-- 
                                        <div style = 
                                            "width: 100%; 
                                            height: 20%; 
                                            align-items: center; 
                                            justify-content: center; 
                                            display: flex;
                                        "> 
                                            <p class = "header_title" style = "margin-top: 1%; width: 100%; text-align: center;">No projects</p>
                                        </div>
                                    -->

                                    <!-- 
                                        <div id = "project_entry" class = "rounded_container project_entry">
                                            <p class = "roboto_font project_entry_p1">Project name: Adminstration team</p>
                                            <p class = "roboto_font project_entry_p2">Id: zxawWga2</p>
                                            <p class = "roboto_font">VMs (4) VMs online (2) Users (3) Admins (2)</p>

                                            <button id="x1" type="button" onclick="update_projects_content()" class="alternate_button">
                                                Open
                                            </button>
                                        </div>
                                    -->
                                </div>
                                
                                <!-- Display is typically "flex" for "project_display" -->
                                <div id = "project_display" style = "display: none; width: 100%; height: 100%;">

                                    <!-- Display is usually "block" for "project_display_vms" and "project_display_users"-->
                                    <div id = "project_display_vms" style = "width: 50%; height: 100%; overflow-y: auto; display: block;"> 
                                        <div style = 
                                            "width: 100%; 
                                            height: 20%; 
                                            align-items: center; 
                                            justify-content: center; 
                                            display: flex;
                                         "> 
                                            <p class = "header_title" style = "margin-top: 1%;">Virtual machines</p>
                                        </div>
                                        <div id = "project_display_vms_content" style = "width: 90%; height: 80%;">
                                            
                                                <div class = "vms_content">
                                                    <p class = "roboto_font project_entry_p2">Virtual machine: Ambroses VM | Status: Online | 255.193.321.0</p>
                                                    <button id="x1" type="button" onclick="update_projects_content()" class="alternate_connect_button">
                                                        Connect
                                                    </button>
                                                </div>
                                            
                                        </div>
                                    </div>

                                    <div id = "project_display_users" style = "width: 50%; height: 100%; overflow-y: auto; display: block;"> 

                                        <div style = 
                                            "width: 100%; 
                                            height: 20%; 
                                            align-items: center; 
                                            justify-content: center; 
                                            display: flex;
                                        "> 
                                            <p class = "header_title" style = "margin-top: 1%;">Project users</p>
                                        </div>

                                        <div id = "project_display_users_content" style = "width: 90%; height: 80%;">
                                            <!-- 
                                                <div class = "member_content">
                                                    <p class = "roboto_font project_entry_p2">Ambrose | ambrose@gmail.com | Type: USER</p>
                                                </div>
                                            -->
                                            <!-- TODO: For admins add a remove user button. Only to remove users -->
                                        </div>
                                    </div>

                                    <div id = "available_vms_display" style = "width: 100%; height: 100%; overflow-y: auto; display: none;"> 

                                        <div style = 
                                            "width: 100%; 
                                            height: 20%; 
                                            align-items: center; 
                                            justify-content: center; 
                                            display: flex;
                                        "> 
                                            <p class = "header_title" style = "margin-top: 1%;">Available virtual machines</p>
                                        </div>
                                        

                                        <div id = "project_available_vms_content" style = "width: 90%; height: 80%;">
                                            <div class = "vms_content">
                                                <p class = "roboto_font project_entry_p2">Virtual machine: Ambroses VM | Status: Online | 255.193.321.0</p>
                                                <button id="x1" type="button" onclick="" class="alternate_connect_button">
                                                    Add VM
                                                </button>
                                            </div>
                                            
                                        </div>
                                    </div>

                                </div>

                                <div id = "project_creation" style = "display: none; width: 100%; height: 100%; align-items: center; 
                                justify-content: center; flex-direction: column;">
                                    <div style = 
                                            "width: 100%; 
                                            height: 20%; 
                                            align-items: center; 
                                            justify-content: center; 
                                            display: flex;
                                         "> 
                                            <p class = "header_title" style = "margin-top: 1%;">Project creation</p>
                                    </div>

                
                                    <div id = "project_detail" class = "project_name_section" style = "display: block;">
                                        <!-- "display: block;" helps put the elements on seperate lines */ -->
                                        <label style="display: block; margin-bottom: 1%;"> 
                                            Project name
                                        </label>
            
                                        <!-- "display: block;" helps put the elements on seperate lines */ -->
                                        <input type="text" placeholder="Project 2Xadakwl" id="project_name_entry" class="entry_style1"> 
                                        
                                        <label id = "project_identifier_label" style="display: block; margin-bottom: 1%; margin-top: 3%;"> 
                                            Project identifier: 2Xadakwl
                                        </label>
                                    </div>

                                    <div id = "project_creation_loading" style = "height: 30%; display: none;">
                                        <div style = "justify-content: center; align-items: center; display: flex; height: 100%;">
                                            <p id = "register_loading_text" class = "roboto_font" style = "font-size: 1vw; margin: 0px; font-weight: bold; margin-right: 2%;">Creating project</p>
                                            <img id="register_loading_icon" src="{% static 'LoadingCircleGif2-Adjusted.gif' %}" class="loader" alt="loading" />
                                        </div>
                                    </div>
            
                                    <div style = "
                                        display: flex;
                                        align-items: center;
                                        justify-content: space-between;
                                        padding-top: 3%;
                                        width: 30%;
                                    ">
                                        <button id = "x1" type="button" onclick="ADMIN_PROMPT_create_project_attempt()" class = "alternate_button" style = "width: 48%;">
                                            Create
                                        </button>
                                        <button id = "project_creation_cancel_button" type="button" onclick="project_creation_cancellation()" class = "alternate_button" style = "width: 48%;">
                                            Back
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id = "groups_section" style = "display: none; width: 100%; height: 100%;">
                            
                            </div>

                            <div id = "all_vms_section" style = "display: none; width: 100%; height: 100%;">
                            
                            </div>

                            <div id = "statistics_section" style = "display: none; width: 100%; height: 100%; justify-content: center; align-items: center;">
                                
                                <div style = 
                                    "width: 100%; 
                                    height: 20%; 
                                    align-items: center; 
                                    justify-content: center; 
                                    display: flex;
                                "> 
                                    <p class = "header_title" style = "margin-top: 1%; width: 100%; text-align: center;">Statistics is not available in this version</p>
                                </div>
                                   
                            </div>

                        </div>
                      
                    </div>

                    <div id = "lower_button_panel" style = "margin-top: 1%; align-items: center; justify-content: space-around; display: flex;">
                        <button id = "x1" type="button" onclick="navigate_to_project_creation()" class = "alternate_button_2">
                            Create project 
                        </button>
                        <button id = "add_vm_button" type="button" onclick="reveal_project_display_available_vms()" class = "alternate_button_2" style = "display: none;">
                            Add VM
                        </button>
                        <button id = "add_user_button" type="button" onclick="navigate_to_project_creation()" class = "alternate_button_2" style = "display: none;">
                            Add user
                        </button>
                    </div>
                    

                    <!-- Dark grey line design | margin-top should be either 1% or 5% -->
                    <div id = "grey_divider" style = "
                        width: 100%; 
                        height: 2px; 
                        background-color: #212529; 
                        margin-top: 1%; 
                        ">
                    </div>
                </div>
            </div>

            <div style = "width: 30px; height: 100%; background-color: #212529;">
                
            </div>
        </div>

    </body>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

        let project_identifier = ""; // Variable used to pass a project identifer code when creating a project
        let selected_project_id = "";


        function update_project_display_with_project_data(project){
            // Display virtual machines
            const project_display_vms_content = document.getElementById("project_display_vms_content");
            project_display_vms_content.innerHTML = ""; // Clearing all the elements under the div content container

            for (const vm of project.project_vms_details){
                const vms_content = document.createElement("div");
                vms_content.className = "vms_content";


                const vm_title = document.createElement("p");
                vm_title.className = "roboto_font project_entry_p2"
                vm_title.innerHTML = "Virtual machine: " + vm.vm_name + " | Status: " + vm.vm_status + " | " + vm.vm_ip;
                vms_content.appendChild(vm_title);

        
                const vm_connect_button = document.createElement("button");
                vm_connect_button.type = "button";
                vm_connect_button.className = "alternate_connect_button"
                //vm_connect_button.onclick = () => navigate_to_project_display(project);
                //VM doesn't have actual connect functionality as this is a demo
                vm_connect_button.innerHTML = "Connect";
                vms_content.appendChild(vm_connect_button);

                // Rendering the div we created into "project_display_vms_content"
                project_display_vms_content.appendChild(vms_content);
            }
            
            // Display project users
            const project_display_users_content = document.getElementById("project_display_users_content");
            project_display_users_content.innerHTML = ""; // Clearing all the elements under the div content container
        
            for (const member of project.project_member_details){
                const member_content = document.createElement("div");
                member_content.className = "member_content";


                const member_title = document.createElement("p");
                member_title.className = "roboto_font project_entry_p2"
                member_title.innerHTML = member.firstname + " | " + member.emailaddress + " | Type: " + member.type; 
                member_content.appendChild(member_title);

                // TODO: For admins, add an additional button that says "remove". Detailed prior again in this same document elsewhere

                // Rendering the div we created into "project_display_vms_content"
                project_display_users_content.appendChild(member_content);
            }
        }

        
        function ADMIN_PROMPT_add_vm(vms_content, vm_add_button, vm_id_to_add) {
            if (selected_project_id == ""){console.log("no selected vm"); return;}

            console.log("add vm");
                            
            vm_add_button.innerHTML = "Adding vm..."

            fetch(
                "{% url 'add_vm_request' %}", 
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": getCookie('csrftoken') //https://www.geeksforgeeks.org/python/csrf-token-in-django/
                    },
                    body: new URLSearchParams(
                        {
                            vm_id: vm_id_to_add,
                            project_id: selected_project_id
                        }
                    )
                }
            )
            .then(response => response.json())
            .then(data => {
                
                if (data.status == "success"){
                    
                    vm_add_button.innerHTML = "Success!"
                    setTimeout(function() {
                        // vms_content.remove(); 
                        vms_content.parentNode.removeChild(vms_content); // removing the listing after success
                    }, 3000);
                    
                    // Updating project information currently being displayed to the user
                    const project_detail_data = data.projects;

                    for (const project of project_detail_data){
                        if (project.project_id == selected_project_id) { 
                            update_project_display_with_project_data(project)
                        }
                    }
                }else{
                    // If the VM has failed to be added, give a failed prompt
                    // then return back to normal
                    console.log(data.message);

                    vm_add_button.innerHTML = "Failed."
                    setTimeout(function() {
                        vm_add_button.innerHTML = "Add VM"
                    }, 3000);
                }
                                                                            
            })
            .catch(error => {
                console.error("Error:", error);
            });
        }

        function update_available_project_vms() { 
            // Display virtual machines
            const project_available_vms_content = document.getElementById("project_available_vms_content");
            
            console.log("fetch name and email detail");
                               
            fetch(
                "{% url 'available_vms_request' %}", 
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": getCookie('csrftoken') //https://www.geeksforgeeks.org/python/csrf-token-in-django/
                    },
                    body: new URLSearchParams({})
                }
            )
            .then(response => response.json())
            .then(data => {
                
                if (data.status == "success"){
                    
                    project_available_vms_content.innerHTML = ""; // Clearing the content views
                    console.log("got available vm data");
                    for (const vm of data.vms){
                        console.log(vm.vm_name);
                        const vms_content = document.createElement("div");
                        vms_content.className = "vms_content";


                        const vm_title = document.createElement("p");
                        vm_title.className = "roboto_font project_entry_p2"
                        vm_title.innerHTML = "Virtual machine: " + vm.vm_name + " | Status: " + vm.vm_status + " | " + vm.vm_ip;
                        vms_content.appendChild(vm_title);

                
                        const vm_add_button = document.createElement("button");
                        vm_add_button.type = "button";
                        vm_add_button.className = "alternate_connect_button";

                        vm_add_button.onclick = () => ADMIN_PROMPT_add_vm(vms_content, vm_add_button, vm.vm_id);
                        
                        vm_add_button.innerHTML = "Add VM";
                        vms_content.appendChild(vm_add_button);

                        // Rendering the div we created into "project_display_vms_content"
                        project_available_vms_content.appendChild(vms_content);
                    }
                    
                }else{
                    console.log(data.message);
                }
                                                                            
            })
            .catch(error => {
                console.error("Error:", error);
            });
        }
        setInterval(update_available_project_vms, 3000); // Updating available vm content every 3 seconds

        function update_name_email_display() {
            const name_display = document.getElementById("name_display");
            const email_display = document.getElementById("email_display");
            console.log("fetch name and email detail");
                               
            fetch(
                "{% url 'email_name_request' %}", 
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": getCookie('csrftoken') //https://www.geeksforgeeks.org/python/csrf-token-in-django/
                    },
                    body: new URLSearchParams({})
                }
            )
            .then(response => response.json())
            .then(data => {

                if (data.status == "success"){
                    console.log(data.message);
                    
                    name_display.innerHTML = data.name;
                    email_display.innerHTML = data.email; 
                }else{
                    console.log(data.message);
                }
                                                                            
            })
            .catch(error => {
                console.error("Error:", error);
            });
        }
        update_name_email_display() // On program launch, fetch the user/admins name/email display


       

        function generate_project_identifier_string() {
            const alphabet = 'abcdefghijklmnopqrstuvwxyz';
            let result = '';

            for (let i = 0; i < 8; i++) {
                // Pick random index
                const randomIndex = Math.floor(Math.random() * alphabet.length);
                let char = alphabet[randomIndex];

                // 50% chance to uppercase
                if (Math.random() < 0.5) {
                char = char.toUpperCase();
                }

                result += char;
            }
            project_identifier = result; 
            return result;
        }

        // user feature where it reutrns you to the last section you were at in the project section
        let previous_project_section = "project_content";
        
        function project_creation_cancellation(){
            const project_creation = document.getElementById("project_creation");
            const project_display = document.getElementById("project_display");
            const project_content = document.getElementById("project_content");

            project_creation.style.display = "none";
            project_display.style.display = "none";
            project_content.style.display = "none";

            if (previous_project_section == "project_content"){
                project_content.style.display = "grid";
            }else if (previous_project_section == "project_display"){
                project_display.style.display = "flex";
            }else if (previous_project_section == "project_creation"){
                project_creation.style.display = "flex";
            }
        }

        function reveal_project_display_available_vms(state)
        {
            const available_vms_display = document.getElementById("available_vms_display");
            const project_display_users = document.getElementById("project_display_users");
            const project_display_vms = document.getElementById("project_display_vms");
      
            if (state == true){
                available_vms_display.style.display = "block";

                project_display_users.style.display = "none";
                project_display_vms.style.display = "none";
            }else if (state == false){
                available_vms_display.style.display = "none";

                project_display_users.style.display = "block";
                project_display_vms.style.display = "block";
            }
            else if (available_vms_display.style.display == "block"){
                available_vms_display.style.display = "none";

                project_display_users.style.display = "block";
                project_display_vms.style.display = "block";
            } else {
                available_vms_display.style.display = "block";

                project_display_users.style.display = "none";
                project_display_vms.style.display = "none";
            }
        }

        function project_panel_navigation(panel){

            previous_project_section = panel; 

            // Navigating to the section within the project section area
            const project_creation = document.getElementById("project_creation");
            const project_display = document.getElementById("project_display");
            const project_content = document.getElementById("project_content");
            
            // Hiding all the panels in the project section
            project_creation.style.display = "none";
            project_display.style.display = "none";
            project_content.style.display = "none";
            available_vms_display.style.display = "none";

            // Working on which one to reval and how
            if (panel == "project_creation"){
                project_creation.style.display = "flex";
            } 
            else if (panel == "project_content"){
                project_content.style.display = "grid";
            }
            else if (panel = "project_display"){
                project_display.style.display = "";
            }
        }

        function navigate_to_project_creation(){ 

            // Creating a project identifier
            const project_identifier = generate_project_identifier_string();

            const project_name = document.getElementById("project_name_entry");
            project_name.placeholder = "Project " + project_identifier;

            const project_identifier_label = document.getElementById("project_identifier_label");
            project_identifier_label.innerHTML = "Project identifier: " + project_identifier;
            
            // Navigating to the section within the project section area
            const project_creation = document.getElementById("project_creation");
            const project_display = document.getElementById("project_display");
            const project_content = document.getElementById("project_content");
            const available_vms_display = document.getElementById("available_vms_display");

            project_creation.style.display = "flex";
            project_display.style.display = "none";
            project_content.style.display = "none";
            available_vms_display.style.display = "none";

            console.log(project_name.value);
        }

        function navigate_to_project_content() {
            const project_content = document.getElementById("project_content");
            const project_display = document.getElementById("project_display");

            project_content.style.display = "grid";
            project_display.style.display = "none";
        }

        function reveal_add_vm_and_user_buttons(state){
            // Reveals "Add VM" and "Add user" buttons
            const add_vm_button = document.getElementById("add_vm_button");
            const add_user_button = document.getElementById("add_user_button");

            if (state == true){
                add_vm_button.style.display = "block";
                add_user_button.style.display = "block";
            }else{
                add_vm_button.style.display = "none";
                add_user_button.style.display = "none";
            }
        }


        function navigate_to_project_display(project) {
            // Updating knowledge on which project has been selected by changing
            // the selected_project_id variable

            selected_project_id = project.project_id; 

            // Reveals "Add VM" and "Add user" buttons
            reveal_add_vm_and_user_buttons(true);

            // Navigates and provides data
            const project_content = document.getElementById("project_content");
            const project_display = document.getElementById("project_display");

            project_content.style.display = "none";
            project_display.style.display = "flex";
            previous_project_section = "project_display";

            // Updating displays for virtual machines and users 
            update_project_display_with_project_data(project)
        }


        function update_projects_content() {
            const project_content = document.getElementById("project_content");
        
            console.log("fetch project listings");

            setTimeout(function() {
                                               
                fetch(
                    "{% url 'project_list_request' %}", 
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                            "X-CSRFToken": getCookie('csrftoken') //https://www.geeksforgeeks.org/python/csrf-token-in-django/
                        },
                        body: new URLSearchParams({})
                    }
                )
                .then(response => response.json())
                .then(data => {

                    if (data.status == "success"){
                        console.log(data.message);
                        
                        project_content.innerHTML = ""; // Clearing all the elements under the div content container
            
                        // Display project details
                        const project_detail_data = data.projects;

                        for (const project of project_detail_data){
                            const project_entry_div = document.createElement("div");
                            project_entry_div.className = "rounded_container project_entry";
                            project_entry_div.id = "project_entry";

                            // <p> class elements
                            const project_title = document.createElement("p");
                            project_title.className = "roboto_font project_entry_p1"
                            project_title.innerHTML = "Project name: " + project.project_name;
                            project_entry_div.appendChild(project_title);

                            const project_id = document.createElement("p");
                            project_id.className = "roboto_font project_entry_p2"
                            project_id.innerHTML = "Id: " + project.project_identifier_code;
                            project_entry_div.appendChild(project_id);

                            const project_details = document.createElement("p");
                            project_details.className = "roboto_font";
                            project_details.innerHTML = "VMs (" + project.project_available_vms + ") VMs online (" + project.project_vms_online + ") Users (" + project.project_users + ") Admins (" + project.project_admins + ")";
                            project_entry_div.appendChild(project_details);
                            
                            // <button> class elements
                            const open_project_button = document.createElement("button");
                            open_project_button.type = "button";
                            open_project_button.className = "alternate_connect_button"
                            open_project_button.onclick = () => navigate_to_project_display(project);
                            open_project_button.innerHTML = "Open";
                            project_entry_div.appendChild(open_project_button);

                            // const delete_project_button - admin
                            // Once the project_entry_div has finished being edited, render
                            // it on the resource dashboard by appending it to the project_content
                            // div element
                            project_content.appendChild(project_entry_div);
                        }
                    }else{
                        console.log(data.message);
                    }
                                                                                
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            }, 1000);

        }
        update_projects_content() // On program launch, fetch project list
        setInterval(update_projects_content, 3000); // Updating project content every 3 seconds

        function ADMIN_PROMPT_create_project_attempt(project_identifier_code){
            // Hiding the project creation form and revealing project loading icon
            const project_detail = document.getElementById("project_detail");
            const project_creation_loading = document.getElementById("project_creation_loading");
           
            const project_name_entry = document.getElementById("project_name_entry");

            project_detail.style.display = "none";
            project_creation_loading.style.display = "block";
            
            // Post request to create project
            setTimeout(function() {
                                               
                fetch(
                    "{% url 'create_project_request' %}", 
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                            "X-CSRFToken": getCookie('csrftoken') //https://www.geeksforgeeks.org/python/csrf-token-in-django/
                        },
                        body: new URLSearchParams(
                            {
                                project_name: project_name_entry.value,
                                project_identifier: project_identifier
                            }
                        )
                    }
                )
                .then(response => response.json())
                .then(data => {

                    if (data.status == "success"){
                        console.log(data.message);
                        
                        const register_loading_text = document.getElementById("register_loading_text");
                        register_loading_text.innerHTML = "Project created!"
                    
                        setTimeout(function() {
                            
                            project_creation_cancellation(); // Moving user back to main project display section
                            register_loading_text.innerHTML = "Creating project"; // Resetting text

                        }, 3000);

                    }else{
                        console.log(data.message);

                        const register_loading_text = document.getElementById("register_loading_text");
                        register_loading_text.innerHTML = "Project failed to create"

                        setTimeout(function() {
                            
                            project_creation_cancellation(); // Moving user back to main project display section
                            register_loading_text.innerHTML = "Creating project"; // Resetting text


                            project_detail.style.display = "block";
                            project_creation_loading.style.display = "none";
                        }, 3000);

                    }
                                                                                
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            }, 1000);
        }

        let section_lock = false;
        let lower_button_panel_toggle = false;

        function toggle_lower_button_panel(toggle){
            const lower_button_panel = document.getElementById("lower_button_panel");
            const grey_divider = document.getElementById("grey_divider");

            if (toggle == true){
                lower_button_panel.style.display = "flex";
                grey_divider.style.marginTop = "1%";
            }else{
                lower_button_panel.style.display = "none";
                grey_divider.style.marginTop = "5%";
            }
        }

        function reset_section_button_background()
        {
            // Section buttons
            const projects_button = document.getElementById("projects_button");
            projects_button.style = "margin-top: 5px;";

            const groups_button = document.getElementById("groups_button");
            groups_button.style = "margin-top: 5px;";

            const all_vms_button = document.getElementById("all_vms_button");
            all_vms_button.style = "margin-top: 5px;";

            const statistics_button = document.getElementById("statistics_button");
            statistics_button.style = "margin-top: 5px;";
        }

        function section_reveal(name) { 
            if (section_lock == false){
                // Reseting selcted vm 
                selected_project_id = "";

                // Hiding add vm and user buttons
                reveal_add_vm_and_user_buttons(false);

                // Section buttons
                const projects_button = document.getElementById("projects_button");
                const groups_button = document.getElementById("groups_button");
                const all_vms_button = document.getElementById("all_vms_button");
                const statistics_button = document.getElementById("statistics_button");

                reset_section_button_background();

                // Hiding all the sections
                const right_content = document.getElementById("right_content");
                for (const child of right_content.children){
                    child.style.display = "none";
                }

                // Revealing section of interest
                const section_element = document.getElementById(name);
                section_element.style.display = "flex";


                if (name == "projects_section"){
                    toggle_lower_button_panel(true);

                    project_panel_navigation("project_content");
                    
                    // Adjusting project button colour background to indicate its selected
                    projects_button.style = "background-color: #FFFFFF; margin-top: 5px;";
                }else{
                    toggle_lower_button_panel(false);
                }

                if (name == "groups_section"){
                    groups_button.style = "background-color: #FFFFFF; margin-top: 5px;";
                }

                if (name == "all_vms_section"){
                    all_vms_button.style = "background-color: #FFFFFF; margin-top: 5px;";
                }

                if (name == "statistics_section"){
                    statistics_button.style = "background-color: #FFFFFF; margin-top: 5px;";
                }

                if (name == "logging_out_section"){
                    section_lock = true;
                }
            }
        }
        section_reveal("projects_section");
        // Doing this so on runtime for the dashboard we navigate to the correct area 

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
            
        function USER_ADMIN_PROMPT_logout_attempt() {

            section_reveal('logging_out_section');
            
            console.log("logout attempt");

            setTimeout(function() {
                                               
                fetch(
                    "{% url 'logout_request' %}", 
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/x-www-form-urlencoded",
                            "X-CSRFToken": getCookie('csrftoken') //https://www.geeksforgeeks.org/python/csrf-token-in-django/
                        },
                        body: new URLSearchParams({})
                    }
                )
                .then(response => response.json())
                .then(data => {

                    if (data.status == "success"){
                        window.location.href = "/login_page/"
                    }else{
                        console.log("error logging out");
                    }
                                                                                
                })
                .catch(error => {
                    console.error("Error:", error);
                });

            }, 1000);

        }

        function USER_PROMPT_forgot_password() {
        
        }
        
        
    </script>
</html>